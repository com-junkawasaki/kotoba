{
  "$id": "https://kotoba.ai/schemas/pih.min.v1.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Program Interaction Hypergraph (PIH) - Node/Edge/Incidence",
  "description": "A unified tripartite hypergraph representation for programs using node/edge/incidence structure",
  "type": "object",
  "version": "1.0.0",

  "definitions": {
    "cid": {
      "type": "string",
      "pattern": "^[uUbB][A-Za-z0-9]+$",
      "description": "Content ID (CID) in multibase format (e.g., uABC123... for Base64URL + Blake3)"
    },
    "gcid": {
      "type": "string",
      "pattern": "^[uUbB][A-Za-z0-9]+$",
      "description": "Graph Content ID (GCID) - Merkle root over subgraph members"
    },
    "node_id": {
      "type": "string",
      "description": "Unique identifier for a node"
    },
    "edge_id": {
      "type": "string",
      "description": "Unique identifier for an edge"
    },
    "role": {
      "type": "string",
      "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$",
      "description": "Role name defining the relationship type"
    },
    "index": {
      "type": "integer",
      "minimum": 0,
      "description": "Index for ordering multiple incidences with same edge and role"
    }
  },

  "properties": {
    "meta": {
      "type": "object",
      "properties": {
        "graph_id": {"type": "string"},
        "schema": {"type": "string"},
        "created_at": {"type": "string", "format": "date-time"}
      }
    },

    "nodes": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {"type": "string"},
          "kind": {"type": "string", "enum": ["Val", "Obj", "State", "Ctrl", "UI", "Other"]},
          "type": {"type": "string"},
          "attributes": {"type": "object"},
          "cid": {"type": "string", "pattern": "^[uUbB][A-Za-z0-9]+$"}
        },
        "required": ["id", "kind", "type"]
      }
    },

    "edges": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {"type": "string"},
          "kind": {"type": "string", "enum": ["Event", "Flow", "Meta"]},
          "label": {"type": "string"},
          "attributes": {"type": "object"},
          "cid": {"type": "string", "pattern": "^[uUbB][A-Za-z0-9]+$"}
        },
        "required": ["id", "kind"]
      }
    },

    "incidences": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "edge": {"type": "string"},
          "node": {"type": "string"},
          "role": {"type": "string", "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$"},
          "idx": {"type": "integer", "minimum": 0},
          "attrs": {"type": "object"},
          "cid": {"type": "string", "pattern": "^[uUbB][A-Za-z0-9]+$"}
        },
        "required": ["edge", "node", "role"]
      }
    },

    "node_embeddings": {
      "type": "object",
      "additionalProperties": {
        "type": "array",
        "items": {"type": "number"}
      }
    },

    "graph_cid": {"type": "string", "pattern": "^[uUbB][A-Za-z0-9]+$"},
    "subgraphs": {"type": "object"},
    "embedding_cache": {"type": "object"},
    "cid_metadata": {"type": "object"}
  },

  "required": ["nodes", "edges", "incidences"]
}
